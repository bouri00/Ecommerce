!function(){var e=function(e){var t={exports:{}};return e.call(t.exports,t,t.exports),t.exports},t=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),i=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")};e(function(e,s){"use strict";function r(e){return Object.keys(e).map(function(t){return t+": "+e[t]+";"}).join(" ")}function a(e){return Object.keys(e).map(function(t){return e[t]})}Object.defineProperty(s,"__esModule",{value:!0});var o=function(){function e(t){var s=t.targetNode,a=t.iframeSrc,o=t.height,n=t.previewToken,h=t.themeStoreId;i(this,e),this.POST_MESSAGE_EVENTS={OPEN_MODAL:"open_modal",CLOSE_MODAL:"close_modal",OPEN_POPOVER:"open_popover",CLOSE_POPOVER:"close_popover",HIDE_IFRAME:"hide_iframe",PURCHASE_THEME:"purchase_theme",CUSTOMIZE_THEME:"customize_theme",COPY_SHARE_LINK:"copy_share_link",TEMPLATE_EDITOR_REFRESH_PAGE:'{"key":"pageRefresh"}'},this.iframeSrc=a,this.height=o||60,this.targetNode=s,this.previewToken=n,this.themeStoreId=h,this.loadingStyles=r({position:"fixed",transform:"translateY("+this.height+"px)",border:"none"}),this.defaultStyles=r({position:"fixed",bottom:0,left:0,"z-index":99999,width:"100%",height:this.height+"px",border:"none","box-shadow":"0 -1px 3px rgba(0, 0, 0, 0.2)",overflow:"hidden",transform:"translateY(0)",transition:"transform 300ms"}),this.modalOpenStyles=r({position:"fixed",bottom:0,left:0,"z-index":999999,width:"100%",height:"100vh",border:"none"})}return t(e,[{key:"init",value:function(){var e=this;this.createIframe(),this.target=this.iframe.contentWindow,this.iframe.contentWindow.addEventListener("DOMContentLoaded",function(){e.iframe.setAttribute("style",e.defaultStyles)}),window.addEventListener("message",this.postMessageBuffer.bind(this))}},{key:"createIframe",value:function(){this.iframe=document.createElement("iframe"),this.iframe.setAttribute("id","preview-bar-iframe"),this.iframe.setAttribute("src",this.iframeSrc),this.iframe.setAttribute("sandbox","allow-same-origin allow-scripts allow-top-navigation"),this.iframe.setAttribute("style",this.loadingStyles),this.targetNode.appendChild(this.iframe)}},{key:"postMessageBuffer",value:function(e){var t=e.data,i=e.origin;!t||a(this.POST_MESSAGE_EVENTS).indexOf(t)<0||this.iframeSrc.indexOf(i)<0||(t!==this.POST_MESSAGE_EVENTS.TEMPLATE_EDITOR_REFRESH_PAGE&&this.postTrekkieData(t),this.postMessageHandler(t,i))}},{key:"postMessageHandler",value:function(e,t){switch(e){case this.POST_MESSAGE_EVENTS.OPEN_MODAL:this.iframe.setAttribute("style",this.modalOpenStyles),this.sendPostMessage("modal_opened",t);break;case this.POST_MESSAGE_EVENTS.CLOSE_MODAL:this.iframe.setAttribute("style",this.defaultStyles),this.sendPostMessage("modal_closed",t);break;case this.POST_MESSAGE_EVENTS.OPEN_POPOVER:this.iframe.setAttribute("style",this.modalOpenStyles),this.sendPostMessage("popover_opened",t);break;case this.POST_MESSAGE_EVENTS.CLOSE_POPOVER:this.iframe.setAttribute("style",this.defaultStyles),this.sendPostMessage("popover_closed",t);break;case this.POST_MESSAGE_EVENTS.HIDE_IFRAME:this.hideIframe();break;case this.POST_MESSAGE_EVENTS.CUSTOMIZE_THEME:this.sendPostMessage("redirected_to_customize_theme",t);break;case this.POST_MESSAGE_EVENTS.PURCHASE_THEME:this.sendPostMessage("redirected_to_purchase",t);break;case this.POST_MESSAGE_EVENTS.TEMPLATE_EDITOR_REFRESH_PAGE:window.location.reload()}}},{key:"sendPostMessage",value:function(e,t){this.target.postMessage(e,t)}},{key:"hideIframe",value:function(){this.iframe.setAttribute("style","display: none"),document.querySelector("html").style.paddingBottom="0"}},{key:"postTrekkieData",value:function(e){window.trekkie.track("theme_sharing",{action:e,token:this.previewToken,themeStoreId:this.themeStoreId})}}]),e}();s["default"]=o,Shopify.PreviewBarInjector=null!=s["default"]?s["default"]:s})}("undefined"!=typeof global?global:"undefined"!=typeof window&&window);